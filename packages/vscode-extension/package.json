{
  "name": "qopilot",
  "displayName": "Qopilot",
  "description": "Q-System infrastructure: Q-semver identity and session discovery tools",
  "version": "0.2.0",
  "publisher": "vgm9",
  "repository": {
    "type": "git",
    "url": "https://github.com/VGM9/qopilot",
    "directory": "packages/vscode-extension"
  },
  "engines": {
    "vscode": "^1.99.0"
  },
  "categories": ["AI", "Chat"],
  "activationEvents": ["onStartupFinished"],
  "main": "./out/extension.js",
  "contributes": {
    "commands": [
      {
        "command": "qopilot.attachFile",
        "title": "Qopilot: Attach File to Chat"
      },
      {
        "command": "qopilot.showLogs",
        "title": "Qopilot: Show Logs"
      },
      {
        "command": "qopilot.showQSemver",
        "title": "Qopilot: Show Q-Semver Identity"
      }
    ],
    "languageModelTools": [
      {
        "name": "qopilot_get_qsemver",
        "displayName": "Get Q-Semver Identity",
        "canBeReferencedInPrompt": true,
        "toolReferenceName": "qsemver",
        "icon": "$(symbol-number)",
        "userDescription": "Get your Q-Semver identity (e.g., 0.6.0). Shows who you are in the Q-number system.",
        "modelDescription": "Get your Q-Semver identity showing both Chronos Q (birth order) and Kairos Q (role assignment). Returns your position in workspace session chronology and role designation. Essential for self-identification.",
        "inputSchema": {
          "type": "object",
          "properties": {
            "includeDetails": {
              "type": "boolean",
              "description": "Include full session chronology and storage details (default: false)"
            },
            "minimal": {
              "type": "boolean",
              "description": "Return only chatSessionId, rebootCount, qSemver â€” under 50 tokens. Use on wake to confirm identity without spending context budget."
            }
          }
        }
      },
      {
        "name": "qopilot_list_sessions",
        "displayName": "List Chat Sessions",
        "canBeReferencedInPrompt": true,
        "toolReferenceName": "sessions",
        "icon": "$(comment-discussion)",
        "userDescription": "List all chat sessions in the current workspace",
        "modelDescription": "List all chat sessions stored in VS Code AppData for the current workspace. Returns session IDs, request counts, reboot counts, custom titles, and kairotic Q values. Use to discover existing sessions before attempting inter-session communication.",
        "inputSchema": {
          "type": "object",
          "properties": {
            "workspaceHash": {
              "type": "string",
              "description": "Optional: specific workspace storage hash. Otherwise uses current workspace."
            },
            "includeEmpty": {
              "type": "boolean",
              "description": "Include sessions with 0 requests (default: false)"
            },
            "fromIndex": {
              "type": "number",
              "description": "Starting index for pagination (default: 0)"
            },
            "limit": {
              "type": "number",
              "description": "Max sessions to return (default: 20, max: 100)"
            }
          }
        }
      },
      {
        "name": "qopilot_get_session",
        "displayName": "Get Session Details",
        "canBeReferencedInPrompt": true,
        "toolReferenceName": "getsession",
        "icon": "$(eye)",
        "userDescription": "Get detailed information about a specific chat session",
        "modelDescription": "Get detailed information about a specific chat session by ID. Can optionally include message history with SAFE PAGINATION. Searches all workspace storage locations. WARNING: includeHistory without fromIndex/limit defaults to first 10 messages.",
        "inputSchema": {
          "type": "object",
          "properties": {
            "sessionId": {
              "type": "string",
              "description": "The session UUID to look up"
            },
            "includeHistory": {
              "type": "boolean",
              "description": "Include message history summaries (default: false). Use with fromIndex and limit."
            },
            "fromIndex": {
              "type": "number",
              "description": "Starting message index. Use negative values like -5 for 'last 5 messages'. (default: 0)"
            },
            "limit": {
              "type": "number",
              "description": "Max messages to return (default: 10, max: 50)"
            }
          },
          "required": ["sessionId"]
        }
      },
      {
        "name": "qopilot_send_message",
        "displayName": "Send Message to Session (Limited)",
        "canBeReferencedInPrompt": true,
        "toolReferenceName": "sendmsg",
        "icon": "$(mail)",
        "userDescription": "Attempt to send a message to another session (file-based only)",
        "modelDescription": "Attempt to send a message to another chat session. WARNING: VS Code does not expose an API for direct message injection. This tool writes to a file-based inbox that the target session must be watching. The target agent must implement inbox polling to receive messages. This is NOT a real-time messaging system.",
        "inputSchema": {
          "type": "object",
          "properties": {
            "sessionId": {
              "type": "string",
              "description": "Target session UUID"
            },
            "message": {
              "type": "string",
              "description": "Message content to send"
            }
          },
          "required": ["sessionId", "message"]
        }
      },
      {
        "name": "qopilot_mcp_control",
        "displayName": "MCP Server Control",
        "canBeReferencedInPrompt": true,
        "toolReferenceName": "mcp",
        "icon": "$(server)",
        "userDescription": "Control MCP servers (start, stop, restart, list)",
        "modelDescription": "Control MCP server lifecycle. Actions: 'list' (show all servers and status), 'start' (start a server by name), 'stop' (stop a server), 'restart' (restart a server), 'start-all' (start all servers). Use 'list' first to discover server names. Server names are from mcp.json configuration.",
        "inputSchema": {
          "type": "object",
          "properties": {
            "action": {
              "type": "string",
              "enum": ["list", "start", "stop", "restart", "start-all"],
              "description": "Action to perform"
            },
            "serverName": {
              "type": "string",
              "description": "Server name (from mcp.json). Required for start/stop/restart."
            }
          },
          "required": ["action"]
        }
      },
      {
        "name": "qopilot_mcp_output",
        "displayName": "MCP Server Output",
        "canBeReferencedInPrompt": true,
        "toolReferenceName": "mcplog",
        "icon": "$(output)",
        "userDescription": "Read MCP server output/error logs",
        "modelDescription": "Read output from an MCP server's log channel. Useful for diagnosing server startup failures or runtime errors. Use 'list' action first to see available servers, then 'read' with a server name to get its output.",
        "inputSchema": {
          "type": "object",
          "properties": {
            "action": {
              "type": "string",
              "enum": ["list", "read", "show"],
              "description": "Action: 'list' shows servers, 'read' gets log content, 'show' opens the output panel"
            },
            "serverName": {
              "type": "string",
              "description": "Server name to read logs from"
            },
            "lines": {
              "type": "number",
              "description": "Number of recent lines to return (default: 50)"
            }
          },
          "required": ["action"]
        }
      },
      {
        "name": "qopilot_attach_file",
        "displayName": "Attach File to Vision",
        "canBeReferencedInPrompt": true,
        "toolReferenceName": "attach",
        "icon": "$(file-media)",
        "userDescription": "Attach an image file so the LLM can see it",
        "modelDescription": "Read an image file from disk and return it as image data that the LLM can see. Use this to programmatically attach images (e.g., rotated versions from RAAS) to your vision context. Supports JPEG, PNG, GIF, WebP, BMP.",
        "inputSchema": {
          "type": "object",
          "properties": {
            "path": {
              "type": "string",
              "description": "Absolute path to the image file"
            }
          },
          "required": ["path"]
        }
      },
      {
        "name": "qopilot_execute_command",
        "displayName": "Execute VS Code Command",
        "canBeReferencedInPrompt": true,
        "toolReferenceName": "cmd",
        "icon": "$(terminal)",
        "userDescription": "Execute a VS Code workbench command",
        "modelDescription": "Execute any VS Code command by ID. Use this to trigger workbench actions like 'workbench.action.reloadWindow', 'workbench.action.chat.attachFile', etc. Returns the command result if any. UI commands (terminal.killAll, reloadWindow, etc.) auto-detect as fire-and-forget to prevent freezing.",
        "inputSchema": {
          "type": "object",
          "properties": {
            "command": {
              "type": "string",
              "description": "The command ID to execute (e.g., 'workbench.action.reloadWindow')"
            },
            "args": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Optional arguments to pass to the command"
            },
            "fireAndForget": {
              "type": "boolean",
              "description": "Don't wait for completion. Auto-detected for UI commands like terminal.killAll. Use true for commands that may freeze or show dialogs."
            }
          },
          "required": ["command"]
        }
      },
      {
        "name": "qopilot_read_output",
        "displayName": "Read Output Channel",
        "canBeReferencedInPrompt": true,
        "toolReferenceName": "output",
        "icon": "$(output)",
        "userDescription": "Read content from any VS Code output channel",
        "modelDescription": "Read the content of any VS Code output channel by name. Reads from VS Code's log files. Use channelName='*' or 'list' to see all available channels. Useful for debugging extensions, MCP servers, and other tools that write to output channels.",
        "inputSchema": {
          "type": "object",
          "properties": {
            "channelName": {
              "type": "string",
              "description": "Name of the output channel to read (e.g., 'Qopilot', 'Prettier', 'GitHub Copilot Chat'). Use '*' to list all available channels."
            },
            "lines": {
              "type": "number",
              "description": "Number of recent lines to return (default: 100)"
            }
          },
          "required": ["channelName"]
        }
      }
    ]
  },
  "scripts": {
    "vscode:prepublish": "npm run compile",
    "compile": "tsc -p ./",
    "watch": "tsc -watch -p ./",
    "package": "npx vsce package --allow-missing-repository -o qopilot.vsix",
    "validate": "node scripts/validate.js",
    "deploy": "npm run compile && npm run validate && npm run package && npm run install-ext",
    "install-ext": "code-insiders --install-extension qopilot.vsix --force"
  },
  "devDependencies": {
    "@types/vscode": "^1.99.0",
    "@types/node": "^20.0.0",
    "typescript": "^5.3.0",
    "@vscode/vsce": "^2.22.0"
  }
}
